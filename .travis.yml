matrix:
  include:
  - name: Android Build
    language: android
    sudo: required
    jdk: oraclejdk8
    env:
      global:
      - ANDROID_API_LEVEL=28
      - ANDROID_BUILD_TOOLS_VERSION=28.0.3
      - ANDROID_ABI=armeabi-v7a
    android:
      components:
        - tools
        - platform-tools
        - tools
        - extra-android-m2repository
      licenses:
        - 'android-sdk-preview-license-52d11cd2'
        - 'android-sdk-license-.+'
        - 'google-gdk-license-.+'
    before_install:
      - touch $HOME/.android/repositories.cfg
      - yes | sdkmanager "platforms;android-28"
      - yes | sdkmanager "build-tools;28.0.3"
    before_cache:
      - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
      - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
    cache:
      directories:
      - $HOME/.gradle/caches/
      - $HOME/.gradle/wrapper/
      - $HOME/.android/build-cache
    before_script:
      - git clone https://github.com/flutter/flutter.git -b stable
      - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
    script:
      - flutter packages get
      - flutter build apk
    deploy:
      provider: releases
      file: TravisExample.apk
      skip_cleanup: true
      on:
        repo: apoorvanand/flutter_epub
        tags: true
        jdk: oraclejdk8
      api_key:
        secure: "PSWXBsM/F7nlx+ImG3NQm0olF2hzt2lrjOZQXuS6MbEO1Yux1olqaqiAiiS3dEA+Lg3+UuTyWaT/uG59GrGA1/BZ0teE5qFGP38PJFdFZUJyVjDTx/J1/KRreILZE6GLNwPTFmUpKoBcg1n4Z2U2IJeDEbhxQ9o1/theszQqJJm9QlAq/IxyvmtLzqgUgbRWgqsXjaZaOOcthDvvsICnY0pjUvfEy57EczPJTcua4ZMb/yiVJrrc0N/YsTIuV1PKBFpqoD/5XCPhpq/e4p3JKJgtgETwql/V31W5BM/OEJp+LWUW6uTJLDBJtQ7K68BF+j21rpESU8Ueh8gvAQ8+Zyzz0lWWEg0v6EU1KY3aiB2z3QPQBYw8DT+/B+NnshHYAyVE1Zx8D8j5/nMEMoY/kbajfINBxHdokyQCyhLOKLzdVcYji0HErwE9gVQk7dX+JHyFnayOPB75l++uRpMLYujMfl4djR1vLBAIvyfu8+azLecfAFKIoLcjC1oI2av+7Inhx4J1eeyUo4do63lm1tm/nwU2sUrWG+BaC9NM7zR5EcByYl1x4SD5ggENB/sG+lZdIE4Gg+S3AXP00fhp8hl0EgfaSpKjbgm3Wk0AliAgVhsH4b88QiOmncBuXREuVsztvEcZcIy56kWlgQpwKe260UXfAHe/l85S4s99duw="
  - name: iOS Build
    os: osx
    language: generic
    osx_image: xcode10.2
    before_script:
      - git clone https://github.com/flutter/flutter.git -b stable
      - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
    script:
      - flutter packages get
      - flutter build ios --no-codesign